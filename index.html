<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>almartin.ch</title>
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-GV9N61X8JR"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            
            gtag('config', 'G-GV9N61X8JR');
            console.log('Google Analytics run');
        </script>
        <!-- almartin.ch site logic-->
        <script>
            const KEY_NAME_IP = 'almartinch-user-ip';
            // const KEY_NAME_COUNTRY = 'almartinch-user-country';
            
            async function getCookie(key) {
                if(cookieStore) {
                    return await cookieStore.get(key);
                }
                // TODO: Other browser support
            }
            async function setCookie(key, value) {
                if (cookieStore) {
                    await cookieStore.set(key, value);
                }
                // TODO: Other browser support
            }

            async function getIpInformation() {
                const url = "https://ipinfo.io/json";
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`Response status: ${response.status}`);
                    }

                    const json = await response.json();
                    
                    return json;
                } catch (error) {
                    console.log(error.message);
                }
            }
            
            function displayInfo(ip) {
                document.getElementById("user-custom-greeting").textContent = `welcome ${ip}`;
            }

            getCookie(KEY_NAME_IP)
                .then(async data => {
                    if (!data) {
                        // Fetch data
                        const ipInformation = await getIpInformation();
                        if (ipInformation) {
                            console.log(ipInformation);
                            displayInfo(ipInformation.ip);
                            setCookie(KEY_NAME_IP, ipInformation.ip);
                        }
                        
                        return;
                    }
                    // Grab stored data
                    displayInfo(data.value);
                });

            console.log('almartin.ch run');
        </script>

        <link href="styles/style.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <h1>almartin.ch</h1>
        <h2 id="user-custom-greeting">welcome</h2>
        <p>
            <table>
                <caption>
                    Fact
                </caption>
                <tbody>
                    <tr>
                        <td>L</td>
                        <td>I</td>
                        <td>F</td>
                        <td>E</td>
                    </tr>
                    <tr>
                        <td>I</td>
                        <td>S</td>
                        <td> </td>
                        <td>S</td>
                    </tr>
                    <tr>
                        <td>U</td>
                        <td>F</td>
                        <td>F</td>
                        <td>E</td>
                    </tr>
                    <tr>
                        <td>R</td>
                        <td>I</td>
                        <td>N</td>
                        <td>G</td>
                    </tr>
                </tbody>
            </table>
        </p>
    </body>
    <footer>
        <p><a href="https://github.com/almartin1911/almartin.ch">source</a></p>
        <address>
            <a href="mailto:amcallejasherrera@gmail.com">amcallejasherrera@gmail.com</a><br />
            <a href="tg:almartinch">@almartinch</a>
        </address>
        <small>
            <p>copyright © 2024 (ál)varo (martín) (c)allejas (h)errera<br />all rights reserved</p>
        </small>
    </footer>
</html>